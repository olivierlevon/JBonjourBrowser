<?xml version="1.0" encoding="UTF-8"?>
<!--
    NetBeans Build Implementation for JBonjourBrowser
    Auto-generated style build file for J2SE projects
-->
<project xmlns:j2seproject1="http://www.netbeans.org/ns/j2se-project/1"
         xmlns:j2seproject3="http://www.netbeans.org/ns/j2se-project/3"
         xmlns:jaxrpc="http://www.netbeans.org/ns/j2se-project/jax-rpc"
         basedir=".."
         default="default"
         name="JBonjourBrowser-impl">

    <!-- Property definitions -->
    <property file="nbproject/project.properties"/>

    <property name="build.dir" value="build"/>
    <property name="build.classes.dir" value="${build.dir}/classes"/>
    <property name="dist.dir" value="dist"/>
    <property name="dist.jar" value="${dist.dir}/JBonjourBrowser.jar"/>
    <property name="src.dir" value="src"/>
    <property name="javac.source" value="21"/>
    <property name="javac.target" value="21"/>
    <property name="main.class" value="BonjourBrowser"/>

    <!-- Java 25 installation path -->
    <property name="java25.home" value="C:/Program Files/Java/jdk-25"/>

    <!-- Classpath definitions -->
    <path id="compile.classpath">
        <pathelement location="jars/dns_sd.jar"/>
        <pathelement location="jars/flatlaf-3.4.jar"/>
    </path>

    <path id="run.classpath">
        <path refid="compile.classpath"/>
        <pathelement location="${build.classes.dir}"/>
    </path>

    <!-- Default target -->
    <target name="default" depends="jar" description="Build the project"/>

    <!-- Initialize build directories -->
    <target name="init">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.classes.dir}"/>
        <mkdir dir="${dist.dir}"/>
    </target>

    <!-- Compile source files -->
    <target name="compile" depends="init" description="Compile source code">
        <javac srcdir="${src.dir}"
               destdir="${build.classes.dir}"
               source="${javac.source}"
               target="${javac.target}"
               includeantruntime="false"
               debug="true"
               deprecation="false"
               encoding="UTF-8"
               fork="true"
               executable="${java25.home}/bin/javac">
            <classpath refid="compile.classpath"/>
        </javac>
        <!-- Copy resources -->
        <copy todir="${build.classes.dir}">
            <fileset dir="${src.dir}" excludes="**/*.java"/>
        </copy>
        <copy todir="${build.classes.dir}/resources" failonerror="false">
            <fileset dir="resources"/>
        </copy>
    </target>

    <!-- Build JAR file -->
    <target name="jar" depends="compile" description="Build JAR file">
        <jar destfile="${dist.jar}" basedir="${build.classes.dir}">
            <manifest>
                <attribute name="Main-Class" value="${main.class}"/>
                <attribute name="Class-Path" value="jars/dns_sd.jar"/>
            </manifest>
        </jar>
        <!-- Copy dependencies to dist -->
        <mkdir dir="${dist.dir}/jars"/>
        <copy todir="${dist.dir}/jars">
            <fileset dir="jars" includes="*.jar"/>
        </copy>
    </target>

    <!-- Run the application -->
    <target name="run" depends="compile" description="Run the application">
        <java classname="${main.class}" fork="true" jvm="${java25.home}/bin/java">
            <classpath refid="run.classpath"/>
            <jvmarg value="-Djava.library.path=lib"/>
            <jvmarg value="-Dfile.encoding=UTF-8"/>
            <jvmarg value="-Dsun.stdout.encoding=UTF-8"/>
            <jvmarg value="-Dsun.stderr.encoding=UTF-8"/>
            <jvmarg value="--enable-native-access=ALL-UNNAMED"/>
            <env key="PATH" path="lib;${env.PATH}"/>
        </java>
    </target>

    <!-- Generate Javadoc -->
    <target name="javadoc" depends="init" description="Generate Javadoc">
        <mkdir dir="${dist.dir}/javadoc"/>
        <javadoc destdir="${dist.dir}/javadoc"
                 author="true"
                 version="true"
                 use="true"
                 windowtitle="JBonjourBrowser API"
                 executable="${java25.home}/bin/javadoc"
                 source="21">
            <classpath refid="compile.classpath"/>
            <fileset dir="${src.dir}" includes="*.java"/>
            <doctitle><![CDATA[<h1>JBonjourBrowser</h1>]]></doctitle>
            <bottom><![CDATA[<i>Copyright &#169; 2006 Internet Real Time Lab, Columbia University. Reworked 2026 Olivier Levon.</i>]]></bottom>
        </javadoc>
    </target>

    <!-- Clean build products -->
    <target name="clean" description="Clean build products">
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </target>

    <!-- Rebuild from scratch -->
    <target name="rebuild" depends="clean,jar" description="Clean and rebuild"/>

    <!-- Run TestRegister -->
    <target name="run-test-register" depends="compile" description="Run TestRegister utility">
        <java classname="TestRegister" fork="true" jvm="${java25.home}/bin/java">
            <classpath refid="run.classpath"/>
            <jvmarg value="-Djava.library.path=lib"/>
            <jvmarg value="-Dfile.encoding=UTF-8"/>
            <jvmarg value="-Dsun.stdout.encoding=UTF-8"/>
            <jvmarg value="-Dsun.stderr.encoding=UTF-8"/>
            <env key="PATH" path="lib;${env.PATH}"/>
            <arg line="${test.args}"/>
        </java>
    </target>

</project>
